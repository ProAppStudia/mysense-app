<ion-content [fullscreen]="true">
  <div class="test-container">
    <div *ngIf="loading()" class="ion-text-center">
      <ion-spinner></ion-spinner>
      <p>Завантаження...</p>
    </div>

    <div *ngIf="!loading() && !schema" class="ion-text-center ion-padding">
      <p>Не вдалося завантажити тест. Будь ласка, спробуйте пізніше.</p>
      <ion-button expand="block" (click)="loadSchema()">Спробувати ще раз</ion-button>
    </div>

    <div class="progress-bars" *ngIf="!loading()">
      <span class="bar" *ngFor="let i of visualStepsArray(); let idx = index" [class.active]="visualStep() >= idx"></span>
    </div>

    <ng-container *ngIf="schema" [ngSwitch]="view()">

    <!-- Вибір типу -->
    <ng-container *ngSwitchCase="'type'">
      <div class="test-heading ion-text-center ion-padding-top">Для кого ви шукаєте підтримку?</div>

      <div class="selection-card" (click)="pickType(1)" [class.selected]="answers().type === 1">
          <div class="card-content-wrapper individual">
            <span class="card-text">Для себе</span>
            <img src="assets/icon/Union.svg" alt="Individual" class="card-image">
          </div>
      </div>

      <div class="selection-card" (click)="pickType(2)" [class.selected]="answers().type === 2">
          <div class="card-content-wrapper family">
            <span class="card-text">Для пари / сім'ї</span>
            <img src="assets/icon/Union2.svg" alt="Family" class="card-image">
          </div>
      </div>

      <div class="selection-card" (click)="pickType(3)" [class.selected]="answers().type === 3">
          <div class="card-content-wrapper child">
            <span class="card-text">Для дитини / підлітка</span>
            <img src="assets/icon/Union3.svg" alt="Child" class="card-image">
          </div>
      </div>
    </ng-container>

    <!-- Інфо сторінка -->
    <ng-container *ngSwitchCase="'info'">
      <div class="ion-text-center">
        <img src="assets/icon/Frame1428.svg" alt="Intro" class="intro-image">
        <div class="test-heading-h2 ion-padding-top">Розкажіть нам про себе, щоб ми могли дати найкращу рекомендацію для вас.</div>
        <p class=" intro-p">Ми задаємо тільки ті запитання, які дійсно необхідні для якісного та персоналізованого підбору психолога.</p>
        <div class="privacy-guarantee">
          <svg viewBox="0 0 22 22" width="22" height="22" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.7022 5.78441L12.7878 3.24968C12.2847 3.03406 11.7153 3.03406 11.2122 3.24968L5.29778 5.78441C4.47855 6.13551 3.99051 6.98635 4.10106 7.87077L4.71405 12.7747C4.9342 14.5359 5.81517 16.1477 7.1787 17.284L10.7196 20.2347C11.4613 20.8528 12.5387 20.8528 13.2804 20.2347L16.8213 17.284C18.1848 16.1477 19.0658 14.5359 19.286 12.7747L19.8989 7.87077C20.0095 6.98635 19.5215 6.13551 18.7022 5.78441Z" stroke="#a89adf" stroke-width="2" stroke-linecap="round"></path>
<path d="M9 12L11.5687 14.5687C11.7918 14.7918 12.1633 14.7551 12.3383 14.4925L16 9" stroke="#a89adf" stroke-width="2" stroke-linecap="round"></path>
</svg>
          <p class="intro-p-left">Ми гарантуємо конфіденційність та надійний захист всіх даних, які ви залишаєте на платформі.</p>
        </div>
        <div class="ion-padding-horizontal ion-margin-top button-group">
          <button fill="outline" (click)="prevStep()" class="back-button">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path class="arrow-icon" d="M15.5 8H1.5M1.5 8L8.5 15M1.5 8L8.5 1" stroke="#795BDA" stroke-width="1.5"></path>
                        </svg>
          </button>
          <ion-button expand="block" (click)="startTest()" class="next-button">Далі  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0.5 8H14.5M14.5 8L7.5 15M14.5 8L7.5 1" stroke="white" stroke-width="1.5"></path>
</svg></ion-button>
        </div>
      </div>
    </ng-container>

    <!-- Крок тесту -->
    <ng-container *ngSwitchCase="'step'">
      <div class="ion-text-center" >
        <div class="test-heading" *ngIf="node">{{ node.header }}</div>
        <p *ngIf="node && node.subheader">{{ node.subheader }}</p>
      </div>

      <div class="question-container" *ngIf="node">
        <!-- radio -->
        <div *ngIf="node.type==='radio' && node.options && !('min' in node.options)" class="radio-group">
          <div class="custom-item" *ngFor="let o of getOptionsAsArray(node); let i = index" (click)="setRadio(node.step_type, (o.id ?? o.value))" [class.selected]="answers()[node.step_type] === (o.id ?? o.value)">
            <ng-container *ngIf="node.step_type === 'format' && i === 0">
              <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path class="fl-icon" d="M10.5 0C8.52219 0 6.58879 0.58649 4.9443 1.6853C3.29981 2.78412 2.01809 4.3459 1.26121 6.17317C0.504333 8.00043 0.306299 10.0111 0.692152 11.9509C1.078 13.8907 2.03041 15.6725 3.42894 17.0711C4.82746 18.4696 6.60929 19.422 8.54910 19.8079C10.4889 20.1937 12.4996 19.9957 14.3268 19.2388C16.1541 18.4819 17.7159 17.2002 18.8147 15.5557C19.9135 13.9112 20.5 11.9778 20.5 10C20.4971 7.34871 19.4426 4.80684 17.5679 2.9321C15.6932 1.05736 13.1513 0.00286757 10.5 0ZM17.7058 5.83333H15.0217C14.4208 4.44082 13.6297 3.1384 12.6708 1.96333C14.7929 2.54077 16.6019 3.93122 17.7058 5.83333ZM14.25 10C14.2432 10.8484 14.1095 11.6911 13.8533 12.5H7.14667C6.89055 11.6911 6.75685 10.8484 6.75 10C6.75685 9.15155 6.89055 8.3089 7.14667 7.5H13.8533C14.1095 8.3089 14.2432 9.15155 14.25 10ZM7.815 14.1667H13.185C12.4777 15.5631 11.5735 16.8507 10.5 17.99C9.42615 16.851 8.52187 15.5634 7.815 14.1667ZM7.815 5.83333C8.52231 4.43689 9.42654 3.1493 10.5 2.01C11.5739 3.14898 12.4781 4.43663 13.185 5.83333H7.815ZM8.33334 1.96333C7.37305 3.13815 6.58049 4.44058 5.97834 5.83333H3.29417C4.39905 3.93036 6.20972 2.5398 8.33334 1.96333ZM2.55084 7.5H5.41667C5.20064 8.31595 5.08864 9.15595 5.08334 10C5.08864 10.8441 5.20064 11.684 5.41667 12.5H2.55084C2.03862 10.8727 2.03862 9.12731 2.55084 7.5ZM3.29417 14.1667H5.97834C6.58049 15.5594 7.37305 16.8618 8.33334 18.0367C6.20972 17.4602 4.39905 16.0696 3.29417 14.1667ZM12.6708 18.0367C13.6297 16.8616 14.4208 15.5592 15.0217 14.1667H17.7058C16.6019 16.0688 14.7929 17.4592 12.6708 18.0367ZM18.4492 12.5H15.5833C15.7994 11.684 15.9114 10.8441 15.9167 10C15.9114 9.15595 15.7994 8.31595 15.5833 7.5H18.4475C18.9597 9.12731 18.9597 10.8727 18.4475 12.5H18.4492Z" fill="#A498D9"></path>
              </svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'format' && i === 1">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">                                            <path class="fl-icon" d="M16.3333 5.33333H15.4158C15.0283 3.43417 13.345 2 11.3333 2H4.66667C2.36917 2 0.5 3.86917 0.5 6.16667V16.8783C0.5 17.54 0.8625 18.145 1.445 18.4567C1.71 18.5992 2.00083 18.6692 2.29083 18.6692C2.6375 18.6692 2.98333 18.5683 3.2825 18.3692L5.74083 16.73C6.31667 18.3425 7.85833 19.5 9.66667 19.5H14.4142L17.7175 21.7025C18.0175 21.9025 18.3625 22.0033 18.7092 22.0033C18.9992 22.0033 19.2892 21.9325 19.555 21.79C20.1383 21.4783 20.5 20.8733 20.5 20.2117V9.5C20.5 7.2025 18.6308 5.33333 16.3333 5.33333ZM2.35833 16.9825C2.3425 16.9925 2.29583 17.0225 2.23167 16.9883C2.16583 16.9533 2.16583 16.8975 2.16583 16.8792V6.16667C2.16583 4.78833 3.2875 3.66667 4.66583 3.66667H11.3325C12.7108 3.66667 13.8325 4.78833 13.8325 6.16667V12C13.8325 13.3783 12.7108 14.5 11.3325 14.5H6.3325C6.06 14.5 5.88167 14.6325 5.86167 14.6458L2.35833 16.9825ZM18.8333 20.2125C18.8333 20.23 18.8333 20.2867 18.7675 20.3217C18.7017 20.3558 18.6567 20.3258 18.6417 20.3158L15.1292 17.9733C14.9925 17.8825 14.8317 17.8333 14.6667 17.8333H9.66667C8.58 17.8333 7.65417 17.1367 7.31 16.1667H11.3333C13.6308 16.1667 15.5 14.2975 15.5 12V7H16.3333C17.7117 7 18.8333 8.12167 18.8333 9.5V20.2125Z" fill="#795BDA"></path>                                        </svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'format' && i === 2">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="fl-icon" d="M15 12.75C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H15Z" fill="#795BDA"></path>
<path class="fl-icon" fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z" fill="#795BDA"></path>
</svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'gender' && i === 0">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">    <path class="fl-icon" d="M12.0823 12.8334C11.8351 12.8334 11.5934 12.76 11.3879 12.6227C11.1823 12.4853 11.0221 12.2901 10.9275 12.0617C10.8329 11.8333 10.8081 11.582 10.8564 11.3395C10.9046 11.097 11.0236 10.8743 11.1985 10.6995C11.3733 10.5247 11.596 10.4056 11.8385 10.3574C12.081 10.3091 12.3323 10.3339 12.5607 10.4285C12.7891 10.5231 12.9843 10.6833 13.1217 10.8889C13.259 11.0945 13.3323 11.3361 13.3323 11.5834C13.3323 11.9149 13.2007 12.2328 12.9662 12.4672C12.7318 12.7017 12.4139 12.8334 12.0823 12.8334ZM19.9365 17.12C20.0405 17.7185 20.0124 18.3325 19.8541 18.919C19.6958 19.5055 19.4112 20.0503 19.0202 20.5152C18.6292 20.9801 18.1413 21.3539 17.5906 21.6104C17.0399 21.8669 16.4398 21.9999 15.8323 22H12.499C12.278 22 12.066 21.9122 11.9098 21.7559C11.7535 21.5997 11.6657 21.3877 11.6657 21.1667V19.2809C11.1217 19.4243 10.5616 19.498 9.99901 19.5C9.43609 19.4971 8.87589 19.4215 8.33235 19.275V21.1667C8.33235 21.3877 8.24455 21.5997 8.08827 21.7559C7.93199 21.9122 7.72003 22 7.49902 22H4.16568C3.55821 21.9999 2.95811 21.8669 2.40743 21.6104C1.85676 21.3539 1.36883 20.9801 0.977829 20.5152C0.586828 20.0503 0.302214 19.5055 0.143929 18.919C-0.0143563 18.3325 -0.0424843 17.7185 0.0615156 17.12L0.311516 15.67C0.394647 15.1878 0.620344 14.7415 0.959501 14.3887C1.29866 14.0359 1.73572 13.7928 2.21434 13.6908C2.69295 13.5887 3.19116 13.6324 3.64472 13.8161C4.09828 13.9999 4.4864 14.3153 4.75902 14.7217C5.81235 16.27 7.83985 17.8334 9.99901 17.8334C12.6073 17.8334 15.1773 15.5175 15.9407 13.3534C16.0019 13.1907 16.1111 13.0504 16.2538 12.9512C16.3966 12.8519 16.566 12.7984 16.7398 12.7975L17.0998 12.8034C17.2612 12.8053 17.4213 12.7752 17.571 12.7148C17.7206 12.6543 17.8567 12.5647 17.9714 12.4512C18.086 12.3377 18.177 12.2025 18.239 12.0535C18.301 11.9045 18.3327 11.7447 18.3323 11.5834C18.3321 11.2911 18.2294 11.0081 18.0421 10.7837C17.8548 10.5593 17.5949 10.4076 17.3074 10.355C17.13 10.3229 16.9679 10.2341 16.8453 10.102C16.7227 9.96997 16.6463 9.80173 16.6273 9.62252C16.4561 7.98526 15.6834 6.4698 14.4589 5.36954C13.2344 4.26928 11.6452 3.6625 9.99901 3.66669C5.35152 3.66669 4.07568 6.69002 3.05068 9.12002C2.86402 9.55919 2.68818 9.97836 2.49902 10.3559C4.17467 10.2673 5.80859 9.80086 7.27853 8.99157C8.74847 8.18228 10.0164 7.05105 10.9873 5.68252C11.0509 5.59344 11.1314 5.51776 11.2243 5.45979C11.3171 5.40182 11.4204 5.36271 11.5284 5.34468C11.6363 5.32665 11.7468 5.33006 11.8534 5.35471C11.96 5.37936 12.0608 5.42478 12.1498 5.48836C12.2389 5.55194 12.3146 5.63244 12.3726 5.72527C12.4305 5.81811 12.4697 5.92145 12.4877 6.02939C12.5057 6.13734 12.5023 6.24778 12.4777 6.35441C12.453 6.46105 12.4076 6.56178 12.344 6.65086C11.2624 8.18432 9.85121 9.45625 8.21402 10.3734C8.46358 10.4346 8.68819 10.5713 8.85727 10.7648C9.02636 10.9584 9.13169 11.1993 9.15893 11.4548C9.18617 11.7103 9.13399 11.968 9.0095 12.1928C8.88502 12.4177 8.69427 12.5986 8.46323 12.7111C8.23219 12.8236 7.97209 12.8622 7.71835 12.8216C7.46461 12.781 7.22955 12.6631 7.04519 12.4841C6.86083 12.3051 6.73612 12.0736 6.68804 11.8212C6.63996 11.5687 6.67086 11.3076 6.77652 11.0734C4.86053 11.8492 2.78885 12.1632 0.729016 11.99C0.557325 11.967 0.397073 11.8911 0.270546 11.7728C0.14402 11.6544 0.0575075 11.4996 0.0230418 11.3299C-0.011424 11.1601 0.00786994 10.9838 0.0782402 10.8255C0.14861 10.6673 0.266559 10.5348 0.415682 10.4467C0.919459 9.87511 1.29433 9.20182 1.51485 8.47252C2.60235 5.89502 4.24902 2.00002 9.99901 2.00002C11.961 1.99538 13.8613 2.68506 15.3636 3.94699C16.8659 5.20892 17.8733 6.9617 18.2073 8.89502C18.7377 9.11672 19.1906 9.49017 19.5094 9.96847C19.8282 10.4468 19.9985 11.0086 19.999 11.5834C19.9976 12.2758 19.7447 12.9442 19.2873 13.4642C19.2932 13.4859 19.3082 13.5034 19.3123 13.5267L19.9365 17.12ZM6.66568 18.6167C5.34756 17.9103 4.22058 16.8946 3.38152 15.6567C3.31011 15.5488 3.21323 15.4601 3.09944 15.3985C2.98564 15.3368 2.85842 15.3042 2.72902 15.3034H2.71485C2.5324 15.3072 2.35695 15.3743 2.21848 15.4931C2.08001 15.612 1.98712 15.7753 1.95568 15.955L1.70568 17.4042C1.64313 17.7632 1.65981 18.1315 1.75455 18.4834C1.84929 18.8352 2.0198 19.1621 2.25415 19.4411C2.48849 19.7202 2.78101 19.9446 3.1112 20.0987C3.4414 20.2529 3.80129 20.3329 4.16568 20.3334H6.66568V18.6167ZM18.2948 17.4042L17.7715 14.3934C17.6131 14.4311 17.4516 14.4551 17.289 14.465C16.4483 16.2391 15.0617 17.6975 13.3323 18.6267V20.3334H15.8323C16.1969 20.3333 16.557 20.2535 16.8874 20.0996C17.2178 19.9457 17.5106 19.7214 17.7452 19.4424C17.9798 19.1634 18.1506 18.8365 18.2455 18.4845C18.3405 18.1326 18.3573 17.7633 18.2948 17.4042Z" fill="white"></path></svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'gender' && i === 1">
              <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">    <path class="fl-icon" d="M13.0841 12.8334C12.8368 12.8334 12.5952 12.76 12.3896 12.6227C12.184 12.4853 12.0238 12.2901 11.9292 12.0617C11.8346 11.8333 11.8099 11.582 11.8581 11.3395C11.9063 11.097 12.0254 10.8743 12.2002 10.6995C12.375 10.5247 12.5977 10.4056 12.8402 10.3574C13.0827 10.3091 13.334 10.3339 13.5624 10.4285C13.7908 10.5231 13.9861 10.6833 14.1234 10.8889C14.2608 11.0945 14.3341 11.3361 14.3341 11.5834C14.3341 11.9149 14.2024 12.2328 13.968 12.4672C13.7335 12.7017 13.4156 12.8334 13.0841 12.8334ZM19.2099 8.89502C18.8753 6.96177 17.8677 5.20917 16.3654 3.94731C14.863 2.68545 12.9627 1.99567 11.0007 2.00002C5.25074 2.00002 3.60407 5.89502 2.51657 8.47252C2.29606 9.20181 1.92118 9.87511 1.4174 10.4467C1.26691 10.5345 1.14771 10.6672 1.07657 10.8262C1.00542 10.9852 0.9859 11.1626 1.02076 11.3333C1.05561 11.504 1.14309 11.6594 1.27089 11.7778C1.39869 11.8962 1.56038 11.9716 1.73324 11.9934C3.79307 12.1666 5.86476 11.8525 7.78074 11.0767C7.67503 11.311 7.6441 11.5721 7.69217 11.8246C7.74023 12.0771 7.86496 12.3086 8.04936 12.4876C8.23376 12.6667 8.46886 12.7845 8.72265 12.8251C8.97644 12.8657 9.23658 12.8271 9.46763 12.7145C9.69868 12.602 9.88941 12.4209 10.0138 12.196C10.1383 11.9711 10.1904 11.7133 10.163 11.4578C10.1357 11.2022 10.0302 10.9613 9.86099 10.7679C9.69178 10.5744 9.46705 10.4378 9.2174 10.3767C10.8546 9.45956 12.2657 8.18764 13.3474 6.65419C13.416 6.56553 13.4661 6.46393 13.4945 6.35548C13.523 6.24702 13.5293 6.13394 13.513 6.023C13.4967 5.91207 13.4582 5.80556 13.3998 5.70985C13.3414 5.61415 13.2642 5.53122 13.173 5.46603C13.0818 5.40083 12.9783 5.35472 12.8689 5.33045C12.7594 5.30618 12.6462 5.30425 12.5359 5.32477C12.4257 5.3453 12.3208 5.38786 12.2274 5.4499C12.134 5.51194 12.0541 5.5922 11.9924 5.68585C11.0206 7.05406 9.75199 8.18481 8.28149 8.99352C6.81098 9.80222 5.17665 10.2679 3.50074 10.3559C3.6899 9.97835 3.86574 9.55919 4.0524 9.12002C5.0774 6.69002 6.35324 3.66669 11.0007 3.66669C12.6473 3.66275 14.2367 4.26994 15.4612 5.37068C16.6857 6.47142 17.4582 7.98738 17.6291 9.62502C17.6482 9.80407 17.7247 9.97213 17.8473 10.104C17.9699 10.2359 18.1319 10.3246 18.3091 10.3567C18.6127 10.4161 18.8835 10.5859 19.0691 10.8334C19.2547 11.0809 19.342 11.3884 19.314 11.6965C19.286 12.0046 19.1448 12.2914 18.9176 12.5014C18.6904 12.7114 18.3934 12.8297 18.0841 12.8334C18.0136 12.8314 17.9434 12.8239 17.8741 12.8109C17.6797 12.7754 17.4791 12.8106 17.3084 12.9101C17.1377 13.0096 17.0082 13.1668 16.9432 13.3534C16.1799 15.5175 13.6107 17.8334 11.0007 17.8334C8.58407 17.8334 6.33407 15.9309 5.3624 14.0509C5.26074 13.8546 5.08527 13.7068 4.87461 13.6399C4.66394 13.573 4.43533 13.5925 4.23907 13.6942C4.04281 13.7959 3.89498 13.9713 3.82809 14.182C3.7612 14.3927 3.78074 14.6213 3.8824 14.8175C4.74608 16.429 6.0616 17.7533 7.6674 18.6275V21.1667C7.6674 21.3877 7.7552 21.5997 7.91148 21.7559C8.06776 21.9122 8.27972 22 8.50074 22C8.72175 22 8.93371 21.9122 9.08999 21.7559C9.24627 21.5997 9.33407 21.3877 9.33407 21.1667V19.2817C10.4258 19.575 11.5757 19.575 12.6674 19.2817V21.1667C12.6674 21.3877 12.7552 21.5997 12.9115 21.7559C13.0678 21.9122 13.2797 22 13.5007 22C13.7218 22 13.9337 21.9122 14.09 21.7559C14.2463 21.5997 14.3341 21.3877 14.3341 21.1667V18.6284C16.0542 17.7036 17.4353 16.2554 18.2774 14.4934C18.9322 14.4487 19.5529 14.1844 20.0389 13.7433C20.525 13.3022 20.848 12.7101 20.9559 12.0627C21.0637 11.4152 20.95 10.7503 20.6332 10.1755C20.3164 9.6007 19.8149 9.14955 19.2099 8.89502Z" fill="#795BDA"></path></svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'gender' && i === 2">
              <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">    <path class="fl-icon" d="M14.75 4.08333C14.75 2.9325 15.6825 2 16.8333 2C17.9842 2 18.9167 2.9325 18.9167 4.08333C18.9167 5.23417 17.9842 6.16667 16.8333 6.16667C15.6825 6.16667 14.75 5.23417 14.75 4.08333ZM20.4617 18.6508C20.1642 18.9925 19.7725 19.2417 19.3333 19.3783V21.1658C19.3333 21.6267 18.9608 21.9992 18.5 21.9992C18.0392 21.9992 17.6667 21.6267 17.6667 21.1658V19.4992H16V21.1658C16 21.6267 15.6275 21.9992 15.1667 21.9992C14.7058 21.9992 14.3333 21.6267 14.3333 21.1658V19.3783C13.895 19.2417 13.5033 18.9925 13.205 18.6508C12.7858 18.17 12.6017 17.5667 12.6867 16.9542L13.81 9.62417C13.9833 8.35833 15.1042 7 16.8333 7C18.5625 7 19.6833 8.35917 19.8583 9.6375L20.9783 16.9425C20.9783 16.9425 20.98 16.9508 20.98 16.955C21.065 17.5675 20.8808 18.17 20.4617 18.6508ZM14.4625 17.5558C14.6142 17.73 14.865 17.8333 15.135 17.8333H18.5333C18.8025 17.8333 19.0542 17.73 19.2058 17.5558C19.2742 17.4767 19.3517 17.3492 19.33 17.1867L18.21 9.8775C18.14 9.3675 17.6683 8.6675 16.8342 8.6675C16.0008 8.6675 15.5283 9.3675 15.46 9.865L14.3367 17.1958C14.3158 17.3483 14.3933 17.4775 14.4625 17.5575V17.5558ZM4.33333 6.16667C5.48417 6.16667 6.41667 5.23417 6.41667 4.08333C6.41667 2.9325 5.48417 2 4.33333 2C3.1825 2 2.25 2.9325 2.25 4.08333C2.25 5.23417 3.1825 6.16667 4.33333 6.16667ZM7.66667 10.3333V14.5C7.66667 15.2383 7.34417 15.9033 6.83333 16.3617V21.1667C6.83333 21.6275 6.46083 22 6 22C5.53917 22 5.16667 21.6275 5.16667 21.1667V17H3.5V21.1667C3.5 21.6275 3.1275 22 2.66667 22C2.20583 22 1.83333 21.6275 1.83333 21.1667V16.3617C1.3225 15.9033 1 15.2392 1 14.5V10.3333C1 8.495 2.495 7 4.33333 7C6.17167 7 7.66667 8.495 7.66667 10.3333ZM5.16667 15.3333C5.62667 15.3333 6 14.96 6 14.5V10.3333C6 9.41417 5.2525 8.66667 4.33333 8.66667C3.41417 8.66667 2.66667 9.41417 2.66667 10.3333V14.5C2.66667 14.96 3.04 15.3333 3.5 15.3333H5.16667ZM10.1667 2C9.70583 2 9.33333 2.3725 9.33333 2.83333V21.1667C9.33333 21.6275 9.70583 22 10.1667 22C10.6275 22 11 21.6275 11 21.1667V2.83333C11 2.3725 10.6275 2 10.1667 2Z" fill="#795BDA"></path></svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'language' && i === 0">
              <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">                                            <path d="M11 22C16.5228 22 21 17.5228 21 12C21 6.47715 16.5228 2 11 2C5.47715 2 1 6.47715 1 12C1 17.5228 5.47715 22 11 22Z" fill="#FFDA44"></path>                                            <path d="M1 12C1 6.47719 5.47719 2 11 2C16.5228 2 21 6.47719 21 12" fill="#338AF3"></path>                                        </svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'language' && i === 1">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">                                            <path d="M10.5 22C16.0223 22 20.5 17.5223 20.5 12C20.5 6.47773 16.0223 2 10.5 2C4.97773 2 0.5 6.47773 0.5 12C0.5 17.5223 4.97773 22 10.5 22Z" fill="#E8E8E8"></path>                                            <path d="M19.8777 15.4765C20.7074 13.2322 20.7074 10.7653 19.8777 8.521H1.12227C0.292577 10.7653 0.292577 13.2322 1.12227 15.4765L10.5 16.3503L19.8777 15.4765Z" fill="#2177DF"></path>                                            <path d="M10.5008 22C14.8008 22 18.4672 19.2891 19.8785 15.4766H1.12305C2.53594 19.2891 6.20078 22 10.5008 22Z" fill="#E8E8E8"></path>                                        </svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'language' && i === 2">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">                                            <path d="M10.5 22C16.0228 22 20.5 17.5228 20.5 12C20.5 6.47715 16.0228 2 10.5 2C4.97715 2 0.5 6.47715 0.5 12C0.5 17.5228 4.97715 22 10.5 22Z" fill="#F0F0F0"></path>                                            <path d="M2.56645 5.91179C1.78094 6.93378 1.18863 8.11171 0.84375 9.39136H6.04602L2.56645 5.91179ZM20.1548 9.39136C19.8099 8.11175 19.2175 6.93382 18.4321 5.91183L14.9526 9.39136H20.1548ZM0.84375 14.6087C1.18867 15.8883 1.78098 17.0663 2.56645 18.0882L6.0459 14.6087H0.84375ZM16.5875 4.06722C15.5655 3.28171 14.3876 2.6894 13.1079 2.34448V7.54671L16.5875 4.06722ZM4.41105 19.9328C5.43305 20.7183 6.61098 21.3106 7.89059 21.6555V16.4533L4.41105 19.9328ZM7.89055 2.34448C6.61094 2.6894 5.43301 3.28171 4.41105 4.06718L7.89055 7.54667V2.34448ZM13.108 21.6555C14.3876 21.3106 15.5655 20.7183 16.5875 19.9328L13.108 16.4533V21.6555ZM14.9526 14.6087L18.4321 18.0883C19.2175 17.0663 19.8099 15.8883 20.1548 14.6087H14.9526Z" fill="#0052B4"></path>                                            <path d="M20.4154 10.6957H11.8044V2.08465C11.3719 2.0283 10.9362 2.00002 10.5 2C10.0579 2 9.62262 2.02906 9.19566 2.08465V10.6956H0.584648C0.528297 11.1281 0.500022 11.5638 0.5 12C0.5 12.4421 0.529063 12.8774 0.584648 13.3043H9.19563V21.9154C10.0615 22.0282 10.9384 22.0282 11.8043 21.9154V13.3044H20.4154C20.4717 12.8719 20.5 12.4362 20.5 12C20.5 11.5579 20.4709 11.1226 20.4154 10.6957Z" fill="#D80027"></path>                                            <path d="M13.1074 14.6086L17.5698 19.071C17.7749 18.8656 17.971 18.6514 18.1576 18.429L14.3372 14.6086H13.1074V14.6086ZM7.89 14.6086H7.88992L3.42762 19.0709C3.633 19.2761 3.8472 19.4722 4.06961 19.6588L7.89 15.8383V14.6086ZM7.89 9.39126V9.39118L3.42766 4.9288C3.22252 5.13418 3.02639 5.34838 2.83984 5.57079L6.66027 9.39122H7.89V9.39126ZM13.1074 9.39126L17.5698 4.92884C17.3644 4.7237 17.1502 4.52759 16.9278 4.34106L13.1074 8.16149V9.39126Z" fill="#D80027"></path>                                        </svg>
            </ng-container>
            <ng-container *ngIf="node.step_type === 'language' && i === 3">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path class="fl-icon" d="M15 12.75C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H15Z" fill="#795BDA"></path>
<path class="fl-icon" fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z" fill="#795BDA"></path>
</svg>
            </ng-container>
            <ng-container *ngIf="!(node.step_type === 'format' && i === 0 || node.step_type === 'format' && i === 1 || node.step_type === 'format' && i === 2 || node.step_type === 'gender' && i === 0 || node.step_type === 'gender' && i === 1 || node.step_type === 'gender' && i === 2 || node.step_type === 'language' && i === 0 || node.step_type === 'language' && i === 1 || node.step_type === 'language' && i === 2 || node.step_type === 'language' && i === 3)">
              
            </ng-container>
            <label class="custom-label">{{ o.text || o.name }}</label>
          </div>
      </div>

      <!-- checkbox -->
      <ng-container *ngIf="node.type==='checkbox' && node.options && !('min' in node.options)">
          <div class="checkbox-group">
            <div class="custom-item" *ngFor="let o of getOptionsAsArray(node); let i = index" (click)="toggleCheckbox(node.step_type, (o.id ?? o.value))" [class.selected]="(answers()[node.step_type] || []).includes(o.id ?? o.value)">
              <label class="custom-label">{{ o.text || o.name }}</label>
              <ion-checkbox [checked]="(answers()[node.step_type] || []).includes(o.id ?? o.value)" mode="md"></ion-checkbox>
            </div>
          </div>
      </ng-container>

      <!-- range -->
      <ng-container *ngIf="node.type==='range' && node.options && ('min' in node.options)">
          <div class="custom-range-item">
            <div *ngIf="node.step_type === 'price'" class="custom-range-price">
              <div class="range-labels">
                <span>{{ answers().min_price || getRangeMin(node) }}</span>
                <span>{{ answers().max_price || getRangeMax(node) }} грн.</span>
              </div>
              <ion-range
                [min]="getRangeMin(node)"
                [max]="getRangeMax(node)"
                [value]="{lower: answers().min_price ?? getRangeMin(node), upper: answers().max_price ?? getRangeMax(node)}"
                (ionInput)="setRange(node.step_type, $event.detail.value)"
                dualKnobs="true"
                [step]="100"
                class="custom-ion-range"
              ></ion-range>
            </div>
            <div *ngIf="node.step_type !== 'price'" class="custom-range-single">
              <ion-range
                     [min]="getRangeMin(node)" [max]="getRangeMax(node)"
                     [value]="answers()[node.step_type]"
                     (ionInput)="setRange(node.step_type, $event.detail.value)"
                     [step]="100"
                     class="custom-ion-range">
              </ion-range>
            </div>
          </div>
      </ng-container>

      <!-- text -->
      <ng-container *ngIf="node.type==='text'">
          <div class="custom-text-input">
            <input type="text" placeholder="Введіть відповідь" [value]="answers()[node.step_type]"
                   (input)="setText(node.step_type, $any($event.target).value)">
          </div>
      </ng-container>

      <!-- city select для offline -->
      <ng-container *ngIf="node.step_type==='format' && answers().format==='offline' && node.cities">
          <div class="custom-select">
            <select [value]="answers().city_id" (change)="setCity($any($event.target).value)">
              <option value="" disabled selected>Оберіть місто</option>
              <option *ngFor="let c of node.cities" [value]="c.city_id">{{ c.name }}</option>
            </select>
          </div>
      </ng-container>
    </div>

    <div class="ion-padding-horizontal ion-margin-top button-group">
        <button fill="outline" (click)="prevStep()" class="back-button">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path class="arrow-icon" d="M15.5 8H1.5M1.5 8L8.5 15M1.5 8L8.5 1" stroke="#795BDA" stroke-width="1.5"></path>
                        </svg>
        </button>
        <ion-button expand="block" *ngIf="node && !node.is_final" [disabled]="!validate(node)" (click)="nextStep()" class="next-button">Далі <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0.5 8H14.5M14.5 8L7.5 15M14.5 8L7.5 1" stroke="white" stroke-width="1.5"></path>
</svg></ion-button>
        <ion-button expand="block" *ngIf="node && node.is_final" color="primary" [disabled]="!validate(node)" (click)="submit()" class="next-button">Отримати результат</ion-button>
    </div>
    </ng-container>

    <!-- Результати -->
    <ng-container *ngSwitchCase="'results'">
      <div class="psychologist-cards-container">
        <ng-container *ngFor="let doctor of results">
          <div class="psychologist-card">
            <div class="card-header">
              <img [src]="doctor.avatarUrl || 'assets/img/IMG_1743.jpeg'" alt="Psychologist" class="psychologist-avatar">
              <div class="header-info">
                <div class="online-offline-status">
                  <span *ngIf="doctor.online" class="status-item online">
                    <ion-icon src="assets/icon/onlain.svg"></ion-icon>
                    Онлайн
                  </span>
                  <span *ngIf="doctor.inPerson" class="status-item offline">
                    <ion-icon src="assets/icon/ochno.svg"></ion-icon>
                    Очно
                  </span>
                </div>
                <p *ngIf="doctor.city" class="location">{{ doctor.city }}</p>
                <h3 class="psychologist-name">{{ doctor.fullName }}</h3>
                <p *ngIf="doctor.verified" class="verified-specialist">
                  <ion-icon src="assets/icon/verified.svg"></ion-icon>
                  Перевірений фахівець
                </p>
              </div>
            </div>
            <p *ngIf="doctor.specialization" class="specialization">{{ doctor.specialization }}</p>
            <div class="stats">
              <span *ngIf="doctor.experienceYears" class="stat-item">
                <ion-icon src="assets/icon/praktika.svg"></ion-icon>
                {{ doctor.experienceYears }} років практики
              </span>
              <span *ngIf="doctor.sessionsCount" class="stat-item">
                <ion-icon src="assets/icon/session.svg"></ion-icon>
                {{ doctor.sessionsCount }}+ сесій
              </span>
            </div>
            <div class="feedback-and-intro">
              <span *ngIf="doctor?.reviewsCountText" class="feedback-item">
                <ion-icon src="assets/icon/otzyv.svg"></ion-icon>
                {{ doctor?.reviewsCountText }}
              </span>
              <span *ngIf="doctor.introMinutes" class="intro-item">
                <ion-icon src="assets/icon/hello.svg"></ion-icon>
                Знайомство {{ doctor.introMinutes }} хв
              </span>
            </div>
            <div class="pricing-and-profile">
              <div class="pricing">
                <div *ngIf="doctor.priceIndividual" class="price-item">
                  <p style="font-size: 14px; color: #9895a6; font-weight: 400;">Індивідуальна</p>
                  <p class="price-value" style="color: #2f264d; font-size: 20px; font-weight: 500;">{{ doctor.priceIndividual }} <span class="currency" style="font-size: 14px; color: #9895a6; font-weight: 400;">грн.</span></p>
                </div>
                <div *ngIf="doctor.priceFamily" class="price-item">
                  <p style="font-size: 14px; color: #9895a6; font-weight: 400;">Сімейна</p>
                  <p class="price-value" style="color: #2f264d; font-size: 20px; font-weight: 500;">{{ doctor.priceFamily }} <span class="currency" style="font-size: 14px; color: #9895a6; font-weight: 400;">грн.</span></p>
                </div>
              </div>
              <ion-button class="profile-button" (click)="goToProfile(doctor.id)">В профіль</ion-button>
            </div>
          </div>
        </ng-container>
      </div>

      <ion-footer>
        <ion-toolbar>
          <ion-button expand="block" (click)="resetAll()">Спробувати ще раз</ion-button>
        </ion-toolbar>
      </ion-footer>
    </ng-container>

  </ng-container></div>
</ion-content>



<ion-content>
  <div class="profile-container" >

    <div *ngIf="isLoggedIn()">
      <div *ngIf="profileLoading()" class="ion-text-center">
        <ion-spinner></ion-spinner>
      </div>

      <div *ngIf="userProfile() as profile">
        <!-- View Mode -->
        <div *ngIf="!isEditing()">
          <ion-list class="profile-menu-group">
            <ion-item button="true" (click)="toggleEditMode()">
              <ion-icon slot="start" name="person-circle-outline" style="font-size: 2em;"></ion-icon>
              <ion-label class="profile-name-label">
                {{ profile.firstname }} {{ profile.lastname }}
              </ion-label>
              <ion-icon slot="end" name="create-outline" class="edit-icon"></ion-icon>
            </ion-item>
          </ion-list>
        </div>

        <!-- Edit Mode -->
        <div *ngIf="isEditing()">
          <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
            <ion-list>
              <ion-item>
                <ion-input label="Ім'я" labelPlacement="floating" formControlName="name" type="text"></ion-input>
              </ion-item>
              <ion-text color="danger" *ngIf="profileForm.get('name')?.invalid && profileForm.get('name')?.touched">
                <p class="ion-padding-start">Ім'я обов'язкове.</p>
              </ion-text>

              <ion-item>
                <ion-input label="Прізвище" labelPlacement="floating" formControlName="surname" type="text"></ion-input>
              </ion-item>
              <ion-text color="danger" *ngIf="profileForm.get('surname')?.invalid && profileForm.get('surname')?.touched">
                <p class="ion-padding-start">Прізвище обов'язкове.</p>
              </ion-text>

              <ion-item>
                <ion-input label="Ел. адреса" labelPlacement="floating" formControlName="email" type="email"></ion-input>
              </ion-item>
              <ion-text color="danger" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
                <p class="ion-padding-start">Будь ласка, введіть дійсну ел. адресу.</p>
              </ion-text>

              <ion-item>
                <ion-input label="Телефон" labelPlacement="floating" formControlName="phone" type="tel"></ion-input>
              </ion-item>
              <ion-text color="danger" *ngIf="profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched">
                <p class="ion-padding-start">Будь ласка, введіть дійсний номер телефону.</p>
              </ion-text>

              <ion-item>
                <ion-input label="Новий пароль" labelPlacement="floating" formControlName="password" type="password"></ion-input>
              </ion-item>

              <ion-item>
                <ion-input label="Підтвердіть новий пароль" labelPlacement="floating" formControlName="confirm" type="password"></ion-input>
              </ion-item>
            </ion-list>

            <ion-text color="danger" *ngIf="profileErrorMsg()">
              <p class="ion-padding-start">{{ profileErrorMsg() }}</p>
            </ion-text>
            <ion-text color="success" *ngIf="profileSuccessMsg()">
              <p class="ion-padding-start">{{ profileSuccessMsg() }}</p>
            </ion-text>

            <ion-button expand="block" type="submit" [disabled]="profileForm.invalid || profileLoading()">
              <ion-spinner *ngIf="profileLoading()" name="lines-small"></ion-spinner>
              <span *ngIf="!profileLoading()">Зберегти зміни</span>
            </ion-button>
            <ion-button expand="block" fill="clear" (click)="toggleEditMode(false)">Скасувати</ion-button>
          </form>
        </div>
      </div>

      <ion-list *ngIf="!isDoctor()" class="profile-menu-group">
        <ion-item detail (click)="viewAllSessions()">
          <ion-icon slot="start" name="calendar-outline"></ion-icon>
          <ion-label>Мої сесії</ion-label>
        </ion-item>
        <ion-item detail routerLink="/tabs/filter" (click)="ionViewWillLeave()">
          <ion-icon slot="start" name="add-circle-outline"></ion-icon>
          <ion-label>Забронювати сесію</ion-label>
        </ion-item>
        <ion-item button="true" detail routerLink="/tabs/tasks" (click)="ionViewWillLeave()">
          <ion-icon slot="start" name="clipboard-outline"></ion-icon>
          <ion-label>Мої завдання</ion-label>
        </ion-item>
      </ion-list>

      <ion-list *ngIf="isDoctor()" class="profile-menu-group doctor-links-group">
        <ion-item button="true" detail routerLink="/tabs/chat" (click)="ionViewWillLeave()">
          <ion-icon slot="start" name="people-outline"></ion-icon>
          <ion-label>Мої клієнти</ion-label>
        </ion-item>
        <ion-item detail (click)="viewAllSessions()">
          <ion-icon slot="start" name="calendar-outline"></ion-icon>
          <ion-label>Мої сесії</ion-label>
        </ion-item>
        <ion-item button="true" detail routerLink="/tabs/doctor-stats" (click)="ionViewWillLeave()">
          <ion-icon slot="start" name="stats-chart-outline"></ion-icon>
          <ion-label>Моя статистика</ion-label>
        </ion-item>
        <ion-item button="true" detail routerLink="/tabs/doctor-work-schedule" (click)="ionViewWillLeave()">
          <ion-icon slot="start" name="time-outline"></ion-icon>
          <ion-label>Робочий графік</ion-label>
        </ion-item>
      </ion-list>
    </div>

    <ion-list class="profile-menu-group">
      <ion-item detail (click)="goToMyDiary()">
        <ion-icon slot="start" name="book-outline"></ion-icon>
        <ion-label>Мій щоденник</ion-label>
      </ion-item>
      <!--<ion-item button="true" detail routerLink="/tabs/tests">
        <ion-icon slot="start" name="checkbox-outline"></ion-icon>
        <ion-label>Мої тести</ion-label>
      </ion-item>
      <ion-item button="true" detail routerLink="/my-library">
        <ion-icon slot="start" name="library-outline"></ion-icon>
        <ion-label>Моя бібліотека</ion-label>
      </ion-item>-->
    </ion-list>

    <ion-list class="profile-menu-group">
      <ion-item button="true" detail routerLink="/tabs/how-to-use" (click)="ionViewWillLeave()">
        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
        <ion-label>Як користуватись додатком</ion-label>
      </ion-item>
      <ion-item detail (click)="goToFaq()">
        <ion-icon slot="start" name="help-circle-outline"></ion-icon>
        <ion-label>Питання/Відповіді</ion-label>
      </ion-item>
      <ion-item detail (click)="goToNotifications()">
        <ion-icon slot="start" name="notifications-outline"></ion-icon>
        <ion-label>Сповіщення</ion-label>
      </ion-item>
      <a href="https://t.me/senseMy_care" target="_blank" class="ion-item-link">
        <ion-item detail="true">
          <ion-icon slot="start" name="headset-outline"></ion-icon>
          <ion-label>Служба підтримки</ion-label>
        </ion-item>
      </a>
      <ion-item detail (click)="goToLegalInfo()">
        <ion-icon slot="start" name="document-text-outline"></ion-icon>
        <ion-label>Правова Інформація</ion-label>
      </ion-item>
     
    </ion-list>

    <ion-list class="profile-menu-group">
      <ion-item button="true" detail routerLink="/emergency-help" (click)="ionViewWillLeave()">
        <ion-icon slot="start" name="warning-outline"></ion-icon>
        <ion-label>Термінова допомога</ion-label>
      </ion-item>
    </ion-list>
    <ion-list *ngIf="isLoggedIn()" class="profile-menu-group">
       <ion-item  button detail="false" (click)="logout()">
        <ion-icon slot="start" name="log-out-outline" class="logout-icon"></ion-icon>
        <ion-label>Вийти</ion-label>
      </ion-item>
    </ion-list>
  </div>

</ion-content>

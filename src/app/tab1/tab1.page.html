<ion-content class="ion-padding">
  <div class="login-buttons" *ngIf="!isLoggedIn()">
    <button class="login-button" (click)="openLoginModal()">
      <ion-icon slot="start" src="assets/icon/sing-in.svg"></ion-icon>
      Вхід
    </button>
    <button class="register-button" (click)="openRegisterModal()">Реєстрація</button>
  </div>

  <div class="main-content" *ngIf="homepageData">
    <!-- My Sessions Block -->
    <div *ngIf="isLoggedIn() && userSessions.length > 0" class="my-sessions-block">
      <div class="sessions-header">
        <h2>Мої сесії</h2>
        <a (click)="viewAllSessions()">Дивитись всі</a>
      </div>

      <div class="sessions-list">
        <div class="session-card" *ngFor="let session of userSessions">
          <div class="session-info">
            <div class="session-date-time">
              <ion-icon name="calendar-outline"></ion-icon>
              <span>{{ formatSessionTime(session.time_range).date }} о {{ formatSessionTime(session.time_range).time }}</span>
            </div>
            <div class="doctor-info">
              <img [src]="'https://mysense.care' + session.doctor_image" alt="{{ session.doctor_name }}">
              <span>{{ session.doctor_name }}</span>
            </div>
          </div>
          <div class="session-actions">
            <ion-button fill="clear" class="reschedule-button" (click)="rescheduleSession(session.id)">
              Перенести
              <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" class="cancel-button" (click)="cancelSession(session.id)">
              Скасувати
              <ion-icon slot="end" name="close-outline"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>
      <ion-button expand="block" class="book-session-button">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Забронювати сесію
      </ion-button>
      <ion-button expand="block" class="chat-session-button" routerLink="/tabs/chat">
        <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
        Написати в чат
      </ion-button>
    </div>

    <!-- Tasks Block -->
    <div *ngIf="isLoggedIn()" class="diary-block">
      
      <div class="diary-card">
       <ion-icon name="checkmark-circle-outline"></ion-icon>
        <h3>Мої завдання</h3>
        <p>Переглядайте та керуйте своїми завданнями, щоб залишатися організованими.</p>
        <ion-button expand="block" class="add-diary-button">Дивитись завдання</ion-button>
      </div>
    </div>

   

    <div class="section-1-block">
      <h1 class="main-title">{{ homepageData.section_1.heading }}</h1>
      <p class="description-text">{{ homepageData.section_1.sub_heading }}</p>
      <ion-button expand="block" class="select-psychologist-button" routerLink="/tabs/tests">{{ homepageData.section_1.button_test_text }}</ion-button>
      <p class="or-text">{{ homepageData.section_1.text_choise_psyhologist }}</p>
      <div class="doctor-list">
          <div *ngFor="let doctor of homepageData.doctors | slice:0:6" class="doctor-card">
            <img [src]="'https://mysense.care' + doctor.img" alt="{{ doctor.firstname }}">
          </div>
        </div>
      <ion-button expand="block" class="free-psychologists-button" routerLink="/tabs/filter">Вільні психологи</ion-button>
    </div>
 <!-- Diary Block -->
    <div class="diary-block">
      
      <div class="diary-card">
        <ion-icon name="book-outline"></ion-icon>
        <h3>Заповніть свій щоденник</h3>
        <p>Не забувайте вести свій особистий щоденник, відстежувати настрій та записувати свої думки.</p>
        <ion-button expand="block" class="add-diary-button" routerLink="/tabs/diary">Додати запис</ion-button>
      </div>
    </div>

    <!-- How It Works Section -->
    <div class="how-it-works-section">
      <h2>Як це працює?</h2>
      <div class="step">
        <p class="step-number">01</p>
        <h3 class="step-title">Пройдіть тест</h3>
        <p class="step-description">Пройдіть короткий, але ефективний тест і ми запропонуємо фахівців, які максимально підходять до вашого запиту</p>
      </div>
      <div class="step">
        <p class="step-number">02</p>
        <h3 class="step-title">Оберіть психолога</h3>
        <p class="step-description">Перегляньте профілі запропонованих психологів та оберіть того, хто вам найбільше сподобався</p>
      </div>
      <div class="step">
        <p class="step-number">03</p>
        <h3 class="step-title">Забронюйте консультацію</h3>
        <p class="step-description">Оберіть зручний для вас час із графіка вільних годин, забронюйте цей час та здійсніть оплату через безпечну платіжну систему.</p>
      </div>
      <div class="step">
        <p class="step-number">04</p>
        <h3 class="step-title">Працюйте з психологом в обраному форматі</h3>
        <p class="step-description">Онлайн-зустрічі проходять за посиланням, які ви будете отримувати в чаті свого особистого профілю. Очні зустрічі проходять у кабінеті психолога.</p>
      </div>
    </div>

    <!-- Section 3 -->
    <div class="free-consultation-banner">
      <span class="free-tag">це безкоштовно ;)</span>
      <h2 class="banner-title">{{ homepageData.section_3.heading_acquaintance }}</h2>
      <p class="banner-description">{{ homepageData.section_3.text_acquaintance }}</p>
      <ion-button expand="block" class="select-psychologist-button-white">Підібрати психолога</ion-button>
    </div>

    <!-- Reviews Slider Section -->
    <div class="reviews-slider-section">
       <h2>{{ homepageData.section_9.heading }}</h2>
      <swiper-container class="reviews-swiper" #reviewsSwiper [pagination]="true" slides-per-view="auto" centered-slides="true">
        <swiper-slide *ngFor="let review of homepageData.section_9.reviews">
          <div class="review-slide-content">
            <h3>{{ review.user_name }}</h3>
            <p class="review-text-content" [class.expanded]="review.showFullText">
              {{ review.text }}
            </p>
            <ion-button *ngIf="review.text.length > TRUNCATE_LENGTH" fill="clear" size="small" (click)="toggleText(review)">
              {{ review.showFullText ? 'Згорнути' : 'Більше' }}
            </ion-button>
            <p class="review-date">{{ review.date }}</p>
          </div>
        </swiper-slide>
      </swiper-container>
    </div>

    <!-- Section 10 - Accordion for Questions and Answers -->
    <div class="section-10">
      <h2>{{ homepageData.section_10.heading }}</h2>
      <ion-accordion-group>
        <ion-accordion *ngFor="let item of homepageData.section_10.items" value="{{ item.heading }}" toggleIcon="add-outline" toggleIconSlot="end">
          <ion-item slot="header">
            <ion-label>{{ item.heading }}</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <div [innerHTML]="item.content"></div>
          </div>
        </ion-accordion>
      </ion-accordion-group>
     <!-- <ion-button expand="block">{{ homepageData.section_10.text_button }}</ion-button>-->
    </div>

    <!-- Section 11 -->
    <div class="section-11">
      <h2>{{ homepageData.section_11.heading }}</h2>
      <div class="articles-slider-container">
        <swiper-container class="articles-swiper" #articlesSwiper [pagination]="true" slides-per-view="auto" centered-slides="true">
          <swiper-slide *ngFor="let article of homepageData.section_11.articles">
            <div class="article-card">
              <img [src]="article.img" alt="{{ article.title }}">
              <h3>{{ article.title }}</h3>
              <p>{{ article.short_description }}</p>
            </div>
          </swiper-slide>
        </swiper-container>
      </div>
    </div>

  </div>

  <ion-modal [isOpen]="loginOpen()" (willDismiss)="closeLoginModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="closeLoginModal()">
              <ion-icon name="close-outline" class="close-icon"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <form [formGroup]="loginForm" (ngSubmit)="onSubmitLogin()">
          <ion-text>
            <h1 class="ion-text-center">Вхід в особистий кабінет</h1>
            <p class="ion-text-center">Увійдіть до свого облікового запису</p>
          </ion-text>
          <ion-list>
            <ion-item>
              <ion-input
                label="Ел. адреса"
                labelPlacement="floating"
                formControlName="email"
                autocomplete="email"
                type="email"
              ></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched">
              <p class="ion-padding-start" *ngIf="loginForm.get('email')?.errors?.['required']">Ел. адреса обов'язкова.</p>
              <p class="ion-padding-start" *ngIf="loginForm.get('email')?.errors?.['email']">Будь ласка, введіть дійсну ел. адресу.</p>
            </ion-text>

            <ion-item>
              <ion-input
                label="Пароль"
                labelPlacement="floating"
                formControlName="password"
                autocomplete="current-password"
                [type]="passwordVisible() ? 'text' : 'password'"
              ></ion-input>
              <ion-button slot="end" fill="clear" (click)="togglePasswordVisibility()">
                <ion-icon [name]="passwordVisible() ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
              </ion-button>
            </ion-item>
            <ion-text color="danger" *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
              <p class="ion-padding-start" *ngIf="loginForm.get('password')?.errors?.['required']">Пароль обов'язковий.</p>
              <p class="ion-padding-start" *ngIf="loginForm.get('password')?.errors?.['minlength']">Пароль повинен бути не менше 6 символів.</p>
            </ion-text>
          </ion-list>

          <div class="ion-padding-vertical ion-text-center">
            <a routerLink="/register" (click)="closeLoginModal()">Реєстрація</a>
            <span class="ion-padding-horizontal"></span>
            <a routerLink="/forgot-password" (click)="closeLoginModal()">Не пам'ятаєте свій пароль?</a>
          </div>

          <ion-text color="danger" *ngIf="errorMsg()">
            <p class="ion-padding-start">{{ errorMsg() }}</p>
          </ion-text>

          <ion-button expand="block" type="submit" [disabled]="loginForm.invalid || loading()">
            <ion-spinner *ngIf="loading()" name="lines-small"></ion-spinner>
            <span *ngIf="!loading()">Увійти</span>
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Register Modal -->
  <ion-modal [isOpen]="registerOpen()" (willDismiss)="closeRegisterModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="closeRegisterModal()">
              <ion-icon name="close-outline" class="close-icon"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <form [formGroup]="registerForm" (ngSubmit)="onSubmitRegister()">
          <ion-text>
            <h1 class="ion-text-center">Реєстрація</h1>
            <p class="ion-text-center" *ngIf="registerStep() === 'form'">Створіть новий обліковий запис</p>
            <p class="ion-text-center" *ngIf="registerStep() === 'code'">{{ infoMsg() }}</p>
          </ion-text>

          <ion-list *ngIf="registerStep() === 'form'">
            <ion-item>
              <ion-input label="Ім'я" labelPlacement="floating" formControlName="name" type="text"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('name')?.invalid && registerForm.get('name')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('name')?.errors?.['required']">Ім'я обов'язкове.</p>
              <p class="ion-padding-start" *ngIf="registerForm.get('name')?.errors?.['minlength']">Ім'я повинно бути не менше 2 символів.</p>
            </ion-text>

            <ion-item>
              <ion-input label="Прізвище" labelPlacement="floating" formControlName="surname" type="text"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('surname')?.invalid && registerForm.get('surname')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('surname')?.errors?.['required']">Прізвище обов'язкове.</p>
              <p class="ion-padding-start" *ngIf="registerForm.get('surname')?.errors?.['minlength']">Прізвище повинно бути не менше 2 символів.</p>
            </ion-text>

            <ion-item>
              <ion-input label="Ел. адреса" labelPlacement="floating" formControlName="email" autocomplete="email" type="email"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('email')?.errors?.['required']">Ел. адреса обов'язкова.</p>
              <p class="ion-padding-start" *ngIf="registerForm.get('email')?.errors?.['email']">Будь ласка, введіть дійсну ел. адресу.</p>
            </ion-text>

            <ion-item>
              <ion-input label="Телефон" labelPlacement="floating" formControlName="phone" inputmode="tel" type="tel"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('phone')?.invalid && registerForm.get('phone')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('phone')?.errors?.['required']">Телефон обов'язковий.</p>
              <p class="ion-padding-start" *ngIf="registerForm.get('phone')?.errors?.['pattern']">Будь ласка, введіть дійсний номер телефону.</p>
            </ion-text>

            <ion-item>
              <ion-input
                label="Пароль"
                labelPlacement="floating"
                formControlName="password"
                autocomplete="new-password"
                [type]="registerPasswordVisible() ? 'text' : 'password'"
              ></ion-input>
              <ion-button slot="end" fill="clear" (click)="toggleRegisterPasswordVisibility()">
                <ion-icon [name]="registerPasswordVisible() ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
              </ion-button>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('password')?.errors?.['required']">Пароль обов'язковий.</p>
              <p class="ion-padding-start" *ngIf="registerForm.get('password')?.errors?.['minlength']">Пароль повинен бути не менше 6 символів.</p>
            </ion-text>

            <ion-item lines="none">
              <ion-checkbox slot="start" formControlName="confirm"></ion-checkbox>
              <ion-label>Я погоджуюся з умовами використання</ion-label>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('confirm')?.invalid && registerForm.get('confirm')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('confirm')?.errors?.['requiredTrue']">Ви повинні погодитись з умовами.</p>
            </ion-text>
          </ion-list>

          <ion-list *ngIf="registerStep() === 'code'">
            <ion-item>
              <ion-input label="Код" labelPlacement="floating" formControlName="code" inputmode="numeric" maxlength="6"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="registerForm.get('code')?.invalid && registerForm.get('code')?.touched">
              <p class="ion-padding-start" *ngIf="registerForm.get('code')?.errors?.['required']">Код обов'язковий.</p>
            </ion-text>
            <div class="ion-text-center ion-padding-vertical">
              <ion-text *ngIf="countdown() > 0">
                <p>Надіслати код повторно через {{ formatTime(countdown()) }}</p>
              </ion-text>
              <ion-button fill="clear" size="small" (click)="resendCode()" [disabled]="!canResend()">Надіслати код ще раз</ion-button>
            </div>
          </ion-list>

          <ion-text color="danger" *ngIf="errorMsg()">
            <p class="ion-padding-start">{{ errorMsg() }}</p>
          </ion-text>

          <ion-button expand="block" type="submit" [disabled]="registerForm.invalid || loading()">
            <ion-spinner *ngIf="loading()" name="lines-small"></ion-spinner>
            <span *ngIf="!loading()">{{ registerStep() === 'form' ? 'Зареєструватися' : 'Підтвердити код' }}</span>
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
